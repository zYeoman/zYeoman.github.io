---
layout: post
title: 数据库2——关系数据库和关系运算
math: true
categories: 数据库 笔记
date: 2015-09-29 19:35:12
---


## 2.4.2 关系代数的四个基本操作
* [交]
* [$\theta$连接]
* [自然连接]
* [除运算]

### 交
所有同时出现在两个关系中的元组集合
$$R \cap S=\{r|r\in R \land r\in S\}$$
交运算可以用差运算重写
$$R \cap S = R - (R - S)$$

### $\theta$连接
从两个关系的广义笛卡儿积中选取给定属性间满足一定条件的元组A,B为R和S上度数相等且可比的属性列（选择一个关系的一个属性比另一个关系的一个属性大、小或相等的元组连接，相等的叫做等值连接）
$$R \bowtie S = \sigma_{R[A]\theta S[B]}(R\times S)$$

### 自然连接
从两个关系的广义笛卡儿积中选取相同属性列B上取值相等的元组，并去掉重复行。
$$R \bowtie S$$

几种特殊情况
* 外连接：把舍弃的元组保存在结果关系中，在其他属性上填null
* 左外连接：只把左边关系中要舍弃的元组保留
* 右外连接：只把右边关系中要舍弃的元组保留

### 除运算
关系R(X, Z), X,Z是属性组，x是X上的取值，定义x在R中的象集为
$$Z_x = \{t[Z]|t\in R \land t[X]=x\}$$


### 关系代数实例
方法：
* 确定查询所涉及的关系
* 执行笛卡儿积或自然联结操作得到一张大表格
* 根据查询对大表格进行水平分割（选择）或垂直分割（投影）

* 当查询涉及*否定*时，*差操作*
* 当查询涉及*全部值*时，*除法操作*

* `Student(Sno, Sname, Ssex, Sage, Sdept)`
* `Course(Cno, Cname, Cpno, Crediit)`
* `SC(Sno, Cno, Grade)`

#### 1. 检索2号课程的选修情况
$\sigma_{cno='2'}(SC)$

#### 2. 检索学习2号课程的学生的学号和成绩
$\Pi_{Sno, Grade}(\sigma_{cno='2'}(SC))$

#### 3. 检索学习2号课程的学生的学号和姓名
$\Pi_{Sno, Sname}(\sigma_{cno='2'}(SC \bowtie Student ))$

#### 4. 检索不学习2号课程的姓名和年龄
用差操作，先得到所有学生的姓名和年龄，再减去选择了2号课程的学生的姓名和年龄
$$\Pi_{Sname,Sage}(S)-\Pi_{Sname,Sage}(\sigma_{cno='2'}(SC)\bowtie S)$$

#### 5. 求至少选修这样一门课的学生姓名，这门课的直接先修课是C2

* 由直接先修课C2找到课号
* 由课号找学号
* 由学号找姓名

普通写法$$\Pi{Sname}(\sigma_{cpno='C2')\bowtie \Pi_{sno,cno}(SC)\bowtie\Pi{sno,sname(S)}})$$
优化写法$$\Pi_{Sname}(\Pi_{Sno}(\Pi_{Cno}(\sigma_{cpno='C2'}(C))\bowtie\Pi_{Sno,Cno}(SC))\bowtie\Pi_{Sno,Sname}(S))$$

#### 6. 求选择了全部课程的学生学号和姓名

* 找出所有课程课号
* 找到选修了所有课的学生学号
* 由学号找到学生学号和姓名

$$\Pi_{Sno,Sname}(\Pi_{Sno,Cno}(SC)\div\Pi_{Cno}(C)\bowtie S)$$

(除的结果不需要再投影一次)

####　7. 求未选修全部课程的学生学号和姓名
$$\Pi_{Sno,Sname}(S)\bowtie(\Pi_{Sno}(S)-\Pi_{Sno,Cno}(SC)\div\Pi_{Cno}(C))$$

#### 8. 求选修了学号s1学生所选全部课程的学生学号

* 求学号s1学生所选全部课程的课号集合
* 求全部学生学号和课号选修集合
* 集合除

$$\Pi_{Sno,Cno}(SC)\div\Pi_{Cno}(\sigma_{Sno='s1'}(SC))$$

#### 9. 选修了s1和s2所选全部课程的学生学号

#### 10. 求学号s1和s2学生都选修了的课程号

#### 11. 同时选修某两门课的学生学号

## 2.5 域关系演算语言QBE
* 基于示例的查询，又被称为基于图像的语言
1. 查询用表格形式，结果也是表格形式，直观、交互性好、高度非过程化
2. 二维语法
3. 操作方式简单

### 检索操作

#### 1. 求电子系全体学生名

| S | Sno | Sname | Sex | Age | Dept |
|---|---|-----|---|---|----|
| |   |P.__T__|||EE|

* T是示例元素，P.表示打印
* EE是查询条件，不需要下划线
* 查询条件中可以使用关系运算符(= != < <= >= > ; =可以不写)

#### 2. 电子系全部学生全部信息


|S|Sno|Sname|Sex|Age|Dept|
|---|---|-----|---|---|----|
| |P.__S1__|P.__T__|P.__S__|P.__16__|EE|

或

|S|Sno|Sname|Sex|Age|Dept|
|---|---|-----|---|---|----|
|P.|||||EE|

#### 3. 电子系年龄大于18的学生学号和年龄

|S|Sno|Sname|Sex|Age|Dept|
|---|---|-----|---|---|----|
| |P.__S1__|||P.>18|EE|

或

|S|Sno|Sname|Sex|Age|Dept|
|---|---|-----|---|---|----|
| |P.__S1__|||P.>18||
| |P.__S1__||||EE|

同一行上的是与的关系，同一个示例名的也是与的关系。

#### 4. 电子系或年龄大于18

|S|Sno|Sname|Sex|Age|Dept|
|---|---|-----|---|---|----|
| |P.__S1__|||P.>18||
| |P.__S2__||||EE|

#### 5. 同时选修C1和C3的学生学号

|SC|Sno|Cno|Grade|
|---|---|---|-----|
||P.__S1__|C1||
||__S1__|C2||

#### 6. 同时选修C1C3的学生姓名学号

|S|Sno|Sname|Sex|Age|Dept|
|---|---|-----|---|---|----|
| |P.__S1__|P.__T__||||


|SC|Sno|Cno|Grade|
|---|---|---|-----|
||P.__S1__|C1||
||__S1__|C2||

通过同名示例连接不同表格

#### 7. 未选修C1课程的学生姓名

|S|Sno|Sname|Sex|Age|Dept|
|---|---|-----|---|---|----|
| |__S1__|P.__T__||||


|SC|Sno|Cno|Grade|
|---|---|---|-----|
|$\lnot$|__S1__|C1||

#### 8. 求至少两人以上选修的课程号

|SC|Sno|Cno|Grade|
|---|---|---|-----|
||__S1__|P.C1||
||$\lnot$__S1__|__C1__||

|SC|Sno|Cno|Grade|
|---|---|---|-----|
||__S1__|P.C1||
||__S2__$\neq$__S1__|__C1__||

#### 常用函数

|函数名|功能|
|------|----|
|CNT|对元组计数|
|SUM|求和|
|AVG|求平均|
|MAX|最大值|
|MIN|最小值|

|SC|Sno|Cno|Grade|
|---|---|---|-----|
|CNT.>=2||P.__C1__||

### 更新操作

* 修改(U.)
* 插入(I.)
* 删除(D.)

#### 9. 把学号为S1的学生改为18

#### 10. 把S1的学生年龄减一

#### 11. 课号为C1的课成绩加5分

#### 12. 加入一个学生

#### 13. 删除学生S6
