---
layout: post
title: Verilog使用
category: 用
date: 2018-12-06 19:01 +0800
create: 2018-12-03 16:34:44 +0800
tags:
  - verilog
  - FPGA
---

- TOC
{:toc}

主要内容来自《设计与验证：verilog hdl》[^1]这本书。

## 语法
![](https://i.loli.net/2018/12/04/5c06449eb60b0.jpg)
*操作符*

* 连接m,n - {m, n}
* m重复n次 - {n{m}}

### Module
```verilog
`timescale 1ns / 1ps
module sample #(
  parameter WIDTH=10,
  parameter PARAM=1
  ) (
  input [WIDTH-1:0] in,
  output [WIDTH-1:0] out
  );
endmodule
```

### 一些技巧
```verilog
// 赋值、延时
{out3,out2,out1,out0} = #4 'b0001;
assign #3 result = (sel) ? A : B;
```

```verilog
// 寄存器
output res_out;
wire res;
always @ (posedge clk or negedge rst_n)
  if (~rst_n)
    res_out <= 0;
  else
    res_out <= res;
```

## 并行和串行
`begin...end`是顺序执行的，`fork...join`是并行执行的。

及时在`begin...end`里，非阻塞赋值`<=`也是并行执行的。

## 仿真与调试

### 输入输出
```verilog
// 打印
$display ("At time %t - ", $time, " something");

// 文件输入输出
//   输出
integer Write_Out_File; // 文件指针
Write_Out_File = $fopen("Write_Out_File.txt");
$fdisplay(Write_Out_File, "@%h\n%h", Mpi_addr, Data_in);
$fclose(Write_Out_File);
//   输入
reg [7:0] DataSource [0:47];
$readmemh("Read_In_File.txt", DataSource);
// $readmemb
// Read_In_File.txt:
//   @2f
//   24
//   @2e
//   91
```

### 延时
```verilog
// 延时的写法
// min:typ:max表示最小、典型和最大延时，顺序为上升延时、下降延时、关闭延时以及输出变成X的延时。未定义的延时取已定义的延时中的最小值
// 注意：assign中的延时通常是被逻辑综合工具忽略的，仅仅用于仿真
assign #(2:3:4, 3:4:5, 1, 2) a = in1 ^ in2;
```

### Testbench写法
```
reg clk=0;
initial begin
  forever #10 clk<=~clk;
end
// 仿真退出
$finish
// 仿真挂起
$stop
```

## Vivado License[^1]
[下载](https://github.com/Maskerk/License/tree/master/vivado_license)或者自建一个lic文件

```
INCREMENT VIVADO_HLS xilinxd 2037.05 permanent uncounted AF3E86892AA2 \
    VENDOR_STRING=License_Type:Bought HOSTID=ANY ISSUER="Xilinx \
    Inc" START=19-May-2016 TS_OK
INCREMENT Vivado_System_Edition xilinxd 2037.05 permanent uncounted \
    A1074C37F742 VENDOR_STRING=License_Type:Bought HOSTID=ANY \
    ISSUER="Xilinx Inc" START=19-May-2016 TS_OK
PACKAGE Vivado_System_Edition xilinxd 2037.05 DFF4A65E0A68 \
    COMPONENTS="ISIM ChipScopePro_SIOTK PlanAhead ChipscopePro XPS \
    ISE HLS_Synthesis AccelDSP Vivado Rodin_Synthesis \
    Rodin_Implementation Rodin_SystemBuilder \
    PartialReconfiguration AUTOESL_FLOW AUTOESL_CC AUTOESL_OPT \
    AUTOESL_SC AUTOESL_XILINX petalinux_arch_ppc \
    petalinux_arch_microblaze petalinux_arch_zynq ap_sdsoc SDK \
    SysGen Simulation Implementation Analyzer HLS Synthesis \
    VIVADO_HLS" OPTIONS=SUITE


# 2037年之前的任何Vivado版本（包括HLS、AccelDSP、System Generator、软硬CPU、SOC、嵌入式Linux、重配置等等功能）都是永久使用。使用本license文件时要改名，文件名不能有汉字和空格。
```


[^1]: 《设计与验证：Verilog HDL》 吴继华 人民邮电出版社
[^2]: [来源](https://www.cnblogs.com/maskerk/p/7350182.html)
